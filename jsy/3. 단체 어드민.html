<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>단체 보험 관리자 페이지</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen">

    <div id="loginOverlay" class="fixed inset-0 bg-slate-900 bg-opacity-95 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full animate-fade-in">
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 text-blue-600 mb-4">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                </div>
                <h2 class="text-xl font-bold text-slate-800">관리자 로그인</h2>
                <p class="text-slate-500 text-sm mt-2">문자로 받으신 ID와 비밀번호를 입력하세요.</p>
            </div>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">아이디</label>
                    <input type="text" value="admin@email.com" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">비밀번호</label>
                    <input type="password" value="1234" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition">로그인</button>
            </form>
        </div>
    </div>

    <div id="dashboard" class="hidden">
        
        <nav class="bg-white border-b border-slate-200 sticky top-0 z-30">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <span class="text-xl font-bold text-slate-800">OO대학교 학생회</span>
                        <span class="ml-3 px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800" id="statusBadge">모집중</span>
                    </div>
                    <div class="flex items-center">
                        <button class="text-slate-500 hover:text-slate-700 text-sm font-medium">로그아웃</button>
                    </div>
                </div>
            </div>
        </nav>

        <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <p class="text-sm font-medium text-slate-500">현재 신청 인원</p>
                    <div class="mt-2 flex items-baseline">
                        <span class="text-3xl font-bold text-slate-900" id="countDisplay">24</span>
                        <span class="ml-1 text-sm text-slate-500">명</span>
                    </div>
                    <div class="mt-4 w-full bg-slate-100 rounded-full h-2">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: 48%"></div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 md:col-span-2 flex flex-col justify-center">
                    <div class="flex justify-between items-center mb-3">
                        <p class="text-sm font-medium text-slate-500">참가자 초대 링크</p>
                        <span class="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded font-bold">터치하여 복사</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="text" readonly value="https://insu.com/join/x7z9a2" class="flex-1 bg-slate-50 border border-slate-200 text-slate-600 text-sm rounded-lg p-3 outline-none">
                        <button onclick="copyLink()" class="bg-slate-800 hover:bg-slate-900 text-white px-4 py-3 rounded-lg font-bold text-sm transition flex items-center">
                            복사
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="px-6 py-5 border-b border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center">
                        <h3 class="text-lg font-bold text-slate-800 mr-3">신청자 명단 확인</h3>
                         <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            <svg class="w-2 h-2 mr-1.5 fill-current" viewBox="0 0 8 8"><circle cx="4" cy="4" r="3" /></svg>
                            실시간
                        </span>
                    </div>
                    
                    <button onclick="downloadExcel()" class="flex items-center justify-center bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2 px-4 rounded-lg transition shadow-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                        엑셀 다운로드 (암호화)
                    </button>
                </div>
                
                <div class="bg-yellow-50 px-6 py-3 border-b border-yellow-100 flex items-start">
                    <svg class="w-5 h-5 text-yellow-600 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                    <p class="text-sm text-yellow-700">다운로드 된 파일에도 <strong>주민등록번호 뒷자리는 마스킹(*) 처리</strong>되어 저장됩니다.<br>총무님은 명단 확인(인원 체크) 용도로만 사용해 주세요.</p>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-50 border-b border-slate-200 text-xs uppercase text-slate-500 font-semibold">
                                <th class="px-6 py-4">No.</th>
                                <th class="px-6 py-4">이름</th>
                                <th class="px-6 py-4">주민등록번호</th>
                                <th class="px-6 py-4">신청일시</th>
                                <th class="px-6 py-4">상태</th>
                            </tr>
                        </thead>
                        <tbody id="applicantTable" class="divide-y divide-slate-100 text-sm text-slate-700">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="actionPanel" class="bg-white rounded-2xl shadow-lg border border-slate-200 p-6 sticky bottom-4">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <div>
                        <h4 class="font-bold text-slate-800 text-lg">모집을 마감하시겠습니까?</h4>
                        <p class="text-sm text-slate-500">모집 완료 버튼을 누르면 더 이상 참가자가 신청할 수 없습니다.</p>
                    </div>
                    <button onclick="confirmList()" class="w-full md:w-auto bg-indigo-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-indigo-700 transition shadow-md">
                        명단 확정 및 견적 요청
                    </button>
                </div>
            </div>

            <div id="invoicePanel" class="hidden bg-white rounded-2xl shadow-lg border border-blue-100 p-6 animate-fade-in">
                <div class="border-b border-slate-100 pb-4 mb-4 flex justify-between items-center">
                    <h3 class="text-lg font-bold text-slate-800 flex items-center">
                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                        보험료 견적 및 입금 안내
                    </h3>
                    <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">담당자 확인 완료</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-slate-50 p-4 rounded-xl">
                        <p class="text-xs text-slate-500 font-bold uppercase mb-2">최종 결제 금액</p>
                        <p class="text-3xl font-bold text-blue-600">125,400원</p>
                        <p class="text-xs text-slate-400 mt-1">총 24명 기준</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <p class="text-xs text-slate-500 font-bold uppercase mb-2">입금 계좌 정보</p>
                        <p class="text-lg font-bold text-slate-800 mb-1">우리은행 1002-123-456789</p>
                        <p class="text-sm text-slate-600">예금주: (주)단체안심보험</p>
                        <button class="mt-3 text-xs bg-white border border-slate-300 px-3 py-1.5 rounded hover:bg-slate-50">계좌 복사</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // 더미 데이터 (마스킹 된 상태)
        const applicants = [
            { id: 24, name: '김철수', rrn: '990101-1******', date: '2025.12.02 14:30' },
            { id: 23, name: '이영희', rrn: '000515-4******', date: '2025.12.02 14:28' },
            { id: 22, name: '박지성', rrn: '981122-1******', date: '2025.12.02 14:15' },
            { id: 21, name: '손흥민', rrn: '920708-1******', date: '2025.12.02 13:50' },
            { id: 20, name: '최유리', rrn: '010310-4******', date: '2025.12.02 13:42' },
        ];

        function handleLogin(e) {
            e.preventDefault();
            const overlay = document.getElementById('loginOverlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('animate-fade-in');
                renderList();
            }, 300);
        }

        function renderList() {
            const tbody = document.getElementById('applicantTable');
            let html = '';
            applicants.forEach(p => {
                html += `
                    <tr class="hover:bg-slate-50 transition">
                        <td class="px-6 py-4 font-medium text-slate-400">${p.id}</td>
                        <td class="px-6 py-4 font-bold text-slate-800">${p.name}</td>
                        <td class="px-6 py-4 font-mono text-slate-600 bg-slate-50 rounded w-fit px-2">${p.rrn}</td>
                        <td class="px-6 py-4 text-slate-500">${p.date}</td>
                        <td class="px-6 py-4"><span class="px-2 py-1 text-xs font-bold text-green-700 bg-green-100 rounded-full">동의완료</span></td>
                    </tr>
                `;
            });
            tbody.innerHTML = html; 
        }

        function copyLink() { alert('초대 링크 복사 완료!'); }

        function confirmList() {
            if(confirm('모집을 마감하시겠습니까?')) {
                document.getElementById('statusBadge').innerText = "마감됨";
                document.getElementById('statusBadge').className = "ml-3 px-2 py-0.5 rounded text-xs font-medium bg-gray-200 text-gray-600";
                document.getElementById('actionPanel').style.display = 'none';
                document.getElementById('invoicePanel').classList.remove('hidden');
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }
        }

        // [핵심] 엑셀 다운로드 기능 (CSV 방식)
        function downloadExcel() {
            // 1. CSV 헤더 생성 (BOM 추가로 한글 깨짐 방지)
            let csvContent = "\uFEFF"; 
            csvContent += "No,이름,주민등록번호,신청일시,상태\n";

            // 2. 데이터 반복문으로 행 추가
            applicants.forEach(row => {
                // 화면에 보이는 데이터(마스킹된 rrn)를 그대로 사용
                csvContent += `${row.id},${row.name},${row.rrn},${row.date},동의완료\n`;
            });

            // 3. 다운로드 링크 생성 및 클릭 트리거
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", "신청자명단_마스킹.csv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>