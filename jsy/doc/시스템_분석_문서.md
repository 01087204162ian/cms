# 단체 여행자보험 신청 시스템 분석 문서

## 📋 목차
1. [시스템 개요](#시스템-개요)
2. [파일별 상세 분석](#파일별-상세-분석)
3. [기술 스택](#기술-스택)
4. [보안 고려사항](#보안-고려사항)
5. [개선 제안](#개선-제안)

---

## 시스템 개요

단체 여행자보험 신청 및 관리 시스템으로, **4단계 워크플로우**로 구성되어 있습니다.

### 워크플로우
```
1. 단체 최초 신청 
   ↓
2. 참가자 정보 입력 
   ↓
3. 단체 관리자 확인 
   ↓
4. 취급자 처리
```

### 주요 사용자
- **단체 담당자**: 보험 신청 및 참가자 관리
- **참가자**: 개인정보 입력 및 신청 내역 조회
- **단체 관리자**: 참가자 명단 확인 및 모집 관리
- **보험사 취급자**: 전체 신청 처리 및 계약 완료

---

## 파일별 상세 분석

### 1. 단체가 최초 요청.html

#### 목적
단체 담당자가 보험 신청을 시작하는 초기 신청 페이지

#### 주요 기능
- **단체 정보 입력**
  - 단체명 (필수)
  - 사업자등록번호 (선택, 세금계산서 발행 시)
  
- **여행 정보 입력**
  - 여행 목적지 (필수)
  - 여행 목적 (워크숍/MT/OT/체육대회/일반여행/수학여행)
  - 시작일/종료일 (필수)
  
- **담당자 정보**
  - 이름 (필수)
  - 연락처 (필수)
  - 이메일 (필수, 증권 수신용)

#### UI/UX 특징
- ✅ Tailwind CSS + Pretendard 폰트 사용
- ✅ 단계별 번호 표시 (1, 2, 3)
- ✅ 그라데이션 헤더 (blue-600 → indigo-700)
- ✅ 제출 후 결과 카드 표시
  - 공유 링크 생성
  - 관리자 계정 정보 (아이디, 임시 비밀번호)

#### 핵심 코드
```javascript
function handleSubmit(e) {
    e.preventDefault(); 
    
    // 로딩 상태 표시
    btn.disabled = true;
    btn.innerHTML = `처리 중...`;
    
    // 1.5초 후 결과 화면으로 전환
    setTimeout(() => {
        document.getElementById('applicationForm').style.display = 'none';
        document.getElementById('resultCard').classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 1500);
}
```

#### 출력 정보
- 참가자 공유용 링크: `https://insu.com/join/x7z9a2`
- 관리자 페이지 정보:
  - 아이디: 입력한 이메일
  - 임시 비밀번호: `a1b2c3d4`

---

### 2. 참가자들이 개인정보입력.html

#### 목적
참가자가 개인정보를 입력하고 신청 내역을 조회/수정/취소하는 페이지

#### 주요 기능

##### 신규 신청 탭
- 이름 입력 (필수)
- 주민등록번호 입력 (필수, 자동 포맷팅)
- 개인정보 수집·이용 동의 (필수)
- 고유식별정보 처리 동의 (필수)

##### 조회/수정/취소 탭
- 이름 + 주민번호로 신청 내역 조회
- 조회 후 정보 수정 가능
- 신청 취소(삭제) 기능

#### 보안 기능

##### 주민등록번호 자동 포맷팅
```javascript
function formatRRN(input) {
    let value = input.value.replace(/[^0-9]/g, '');
    if (value.length > 6) {
        input.value = value.substring(0, 6) + '-' + value.substring(6, 13);
    } else {
        input.value = value;
    }
}
```

##### 주민번호 검증 (Checksum 알고리즘)
```javascript
function isValidRRN(rrn) {
    const num = rrn.replace(/[^0-9]/g, '');
    if (num.length !== 13) return false;
    const arr = num.split('').map(Number);
    const weights = [2, 3, 4, 5, 6, 7, 8, 9, 2, 3, 4, 5];
    let sum = 0;
    for (let i = 0; i < 12; i++) sum += arr[i] * weights[i];
    const result = (11 - (sum % 11)) % 10;
    return result === arr[12];
}
```

#### UI/UX 특징
- ✅ 모바일 최적화
  - `user-scalable=no`
  - `touch-action: manipulation`
  - 입력 필드 `font-size: 16px` (iOS 줌 방지)
- ✅ 탭 전환 애니메이션
- ✅ 입력 오류 시 shake 애니메이션
- ✅ 하단 고정 버튼 (모바일 UX)

#### 단체 정보 표시
- 단체명: "OO대학교 학생회 하계 워크숍"
- 여행 기간: "2025.07.15 ~ 2025.07.17 (제주도)"

---

### 3. 단체 어드민.html

#### 목적
단체 관리자가 참가자 명단을 확인하고 모집을 관리하는 대시보드

#### 주요 기능

##### 대시보드
- **실시간 신청 인원**: 24명 / 진행률 48%
- **참가자 초대 링크**: 복사 기능
- **신청자 명단 테이블**
  - No., 이름, 주민등록번호(마스킹), 신청일시, 상태

##### 관리 기능
- **엑셀 다운로드**: 주민번호 뒷자리 마스킹 처리
- **모집 마감**: 더 이상 신청 불가
- **견적 요청**: 명단 확정 후 견적 요청
- **입금 안내**: 계좌 정보 표시

#### 보안 특징

##### 주민등록번호 마스킹
- 화면 표시: `990101-1******`
- 엑셀 다운로드 시에도 마스킹 유지

##### 엑셀 다운로드 구현
```javascript
function downloadExcel() {
    // 1. CSV 헤더 생성 (BOM 추가로 한글 깨짐 방지)
    let csvContent = "\uFEFF"; 
    csvContent += "No,이름,주민등록번호,신청일시,상태\n";

    // 2. 데이터 반복문으로 행 추가
    applicants.forEach(row => {
        // 화면에 보이는 데이터(마스킹된 rrn)를 그대로 사용
        csvContent += `${row.id},${row.name},${row.rrn},${row.date},동의완료\n`;
    });

    // 3. 다운로드 링크 생성 및 클릭 트리거
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.setAttribute("href", url);
    link.setAttribute("download", "신청자명단_마스킹.csv");
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
```

#### UI 특징
- ✅ 로그인 오버레이 모달
- ✅ 상태 배지 (모집중/마감됨)
- ✅ 진행률 프로그레스 바
- ✅ 스티키 액션 패널 (하단 고정)
- ✅ 경고 메시지: "다운로드 된 파일에도 주민등록번호 뒷자리는 마스킹(*) 처리되어 저장됩니다."

#### 견적 정보
- 최종 결제 금액: 125,400원 (24명 기준)
- 입금 계좌: 우리은행 1002-123-456789
- 예금주: (주)단체안심보험

---

### 4. 취급자 어드민.html

#### 목적
보험사 취급자(실무자)가 전체 단체 신청을 관리하는 시스템

#### 주요 기능

##### 대시보드 통계
- **전체 신청**: 142건
- **신규 신청 (미처리)**: 3건 (빨간색 강조)
- **입금 대기**: 5건 (주황색 강조)
- **이번달 완료**: 48건 (초록색 강조)

##### 접수 리스트 테이블
- 순번, 단체명, 여행기간, 신청인원, 현재상태, 관리자 메모
- 행 클릭 시 상세 모달 열기
- 인라인 메모 저장 기능

##### 상태별 색상 구분
- **신청완료** (회색): `status-applied`
- **청약서안내** (주황): `status-quoted`
- **입금완료** (파랑): `status-paid`
- **계약완료** (초록): `status-done`

#### 업무 플로우 (3단계)

##### Step 1: 명단 엑셀 다운로드
- 목적: 설계용
- 기능: 전체 주민번호 포함 엑셀 다운로드
- 버튼: "다운로드 (전체)"

##### Step 2: 청약서/계좌 안내
- 목적: 총무에게 발송
- 기능: 청약서와 계좌정보 문자 발송
- 버튼: "문자 발송"

##### Step 3: 증권 업로드/완료
- 목적: 최종 완료
- 기능: 가입완료 처리
- 버튼: "계약 완료"

#### 상세 모달 정보
- 담당자 정보: 이름, 연락처
- 여행기간: 시작일 ~ 종료일
- 신청인원: 명수

#### 기술적 특징
- ✅ 인라인 메모 저장 (테이블 내 직접 입력)
- ✅ 행 클릭으로 상세 모달 열기
- ✅ 페이지네이션 UI (실제 기능 미구현)
- ✅ 검색/필터 기능 UI (실제 기능 미구현)

---

## 기술 스택

### 프론트엔드
- **CSS Framework**: Tailwind CSS (CDN)
- **폰트**: Pretendard (CDN)
- **JavaScript**: Vanilla JS (프레임워크 없음)

### 공통 UI 패턴
- ✅ 반응형 디자인 (모바일/데스크톱)
- ✅ 애니메이션 효과
  - `fadeIn`: 부드러운 등장 효과
  - `shake`: 오류 시 흔들림 효과
- ✅ 그라데이션 버튼
- ✅ 카드 기반 레이아웃
- ✅ 모달/오버레이

### 브라우저 호환성
- 모던 브라우저 지원
- 모바일 최적화 (iOS/Android)

---

## 보안 고려사항

### ✅ 구현된 보안 기능

#### 1. 주민등록번호 마스킹
- **단체 관리자 화면**: 뒷자리 마스킹 (`990101-1******`)
- **엑셀 다운로드**: 마스킹 유지
- **취급자 화면**: 전체 주민번호 표시 (업무상 필요)

#### 2. 주민번호 검증
- Checksum 알고리즘으로 유효성 검증
- 잘못된 번호 입력 시 오류 표시

#### 3. CSV 다운로드 보안
- BOM 추가로 한글 깨짐 방지
- 마스킹된 데이터만 다운로드

### ⚠️ 보안 개선 필요 사항

1. **HTTPS 필수**: 민감한 개인정보 전송 시 필수
2. **서버 측 검증**: 클라이언트 검증만으로는 부족
3. **암호화 저장**: 주민번호는 암호화하여 저장
4. **접근 제어**: 관리자 권한 분리 및 세션 관리
5. **로그 관리**: 접근 로그 및 감사 로그 기록

---

## 개선 제안

### 1. 백엔드 연동
현재는 프론트엔드만 구현되어 있습니다.

**필요한 API 엔드포인트:**
```
POST /api/group/apply          # 단체 신청
POST /api/participant/join     # 참가자 등록
GET  /api/participant/check    # 참가자 조회
PUT  /api/participant/update  # 참가자 수정
DELETE /api/participant/cancel # 참가자 취소
GET  /api/admin/dashboard     # 관리자 대시보드
GET  /api/admin/list          # 신청자 명단
POST /api/admin/close         # 모집 마감
GET  /api/agent/list          # 취급자 리스트
POST /api/agent/process        # 업무 처리
```

### 2. 실제 인증 시스템
- 현재 로그인 기능은 UI만 존재
- JWT 또는 세션 기반 인증 구현 필요
- 비밀번호 암호화 저장

### 3. 데이터 검증 강화
- 서버 측 검증 추가
- 입력값 sanitization
- SQL Injection 방지
- XSS 방지

### 4. 에러 처리
- 네트워크 오류 처리
- 유효성 검사 실패 처리
- 사용자 친화적 에러 메시지

### 5. 사용자 경험 개선
- 로딩 스피너 개선
- 성공/실패 토스트 메시지
- 폼 자동 저장 (draft)
- 반응형 디자인 최적화

### 6. 성능 최적화
- 이미지 최적화
- 코드 분할 (Code Splitting)
- 캐싱 전략

### 7. 접근성 (A11y)
- 키보드 네비게이션
- 스크린 리더 지원
- ARIA 레이블 추가

### 8. 테스트
- 단위 테스트
- 통합 테스트
- E2E 테스트

---

## 파일 구조

```
jsy/
├── 1. 단체가 최초 요청.html
├── 2. 참가자들이 개인정보입력.html
├── 3. 단체 어드민.html
├── 4. 취급자 어드민.html
└── doc/
    └── 시스템_분석_문서.md (본 문서)
```

---

## 결론

이 시스템은 **단체 여행자보험 신청 및 관리**를 위한 웹 애플리케이션으로, 다음과 같은 특징을 가지고 있습니다:

### 장점
- ✅ 직관적인 사용자 인터페이스
- ✅ 모바일 최적화
- ✅ 주민번호 마스킹 등 보안 고려
- ✅ 단계별 명확한 워크플로우

### 개선 필요
- ⚠️ 백엔드 연동 필요
- ⚠️ 실제 인증 시스템 구현 필요
- ⚠️ 서버 측 검증 추가 필요
- ⚠️ 에러 처리 강화 필요

전반적으로 **사용자 경험과 보안을 고려한 잘 설계된 시스템**입니다.

---

**작성일**: 2025년  
**버전**: 1.0  
**작성자**: 시스템 분석

