 홀인원 보험 신청 시나리오별 처리 가이드
📋 기본 전제 조건

1개 쿠폰 = 최대 2회 사용 가능
중복 검증 기준: 쿠폰번호 + 골프장 + 티업시간
핸드폰 오입력 판단 기준: 이름 동일 + 핸드폰 번호 상이


🔸 Case 1: 첫 번째 신청 (used_count = 0)
1-1. 신규 신청
📝 신청: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E

✅ 처리결과: 정상 진행
   - used_count: 0 → 1
   - 신규 신청 생성

🔸 Case 2: 두 번째 신청 (used_count = 1)
2-1. 핸드폰 오입력 재신청
📋 기존: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E (잘못된 번호)
📝 신청: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰F (올바른 번호)

🔄 처리결과: 기존 삭제 후 새로 생성
   1. DELETE 기존 신청 (id, 동반자 포함)
   2. used_count: 1 → 0
   3. INSERT 새 신청
   4. used_count: 0 → 1
   
💬 메시지: "핸드폰 번호가 수정되어 기존 신청을 업데이트합니다."
2-2. 정상적인 다른 조건 신청
📋 기존: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E
📝 신청: 쿠폰A + 골프장X + 시간Y + 이름Z + 핸드폰W

✅ 처리결과: 정상 진행
   - used_count: 1 → 2
   - 신규 신청 생성
2-3. 완전히 동일한 신청
📋 기존: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E
📝 신청: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E

❌ 처리결과: 신청 거부
💬 메시지: "이미 동일한 조건으로 신청이 완료되었습니다."

🔸 Case 3: 세 번째 신청 (used_count = 2, 완전 사용)
3-1. 핸드폰 오입력 재신청 (첫 번째 기록 수정)
📋 기존1: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E (잘못된 번호)
📋 기존2: 쿠폰A + 골프장X + 시간Y + 이름Z + 핸드폰W
📝 신청:  쿠폰A + 골프장B + 시간C + 이름D + 핸드폰F (올바른 번호)

🔄 처리결과: 기존1 삭제 후 새로 생성
   1. DELETE 기존1 신청 (id, 동반자 포함)
   2. used_count: 2 → 1
   3. INSERT 새 신청
   4. used_count: 1 → 2
   
💬 메시지: "핸드폰 번호가 수정되어 기존 신청을 업데이트합니다."
3-2. 핸드폰 오입력 재신청 (두 번째 기록 수정)
📋 기존1: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E
📋 기존2: 쿠폰A + 골프장X + 시간Y + 이름Z + 핸드폰W (잘못된 번호)
📝 신청:  쿠폰A + 골프장X + 시간Y + 이름Z + 핸드폰V (올바른 번호)

🔄 처리결과: 기존2 삭제 후 새로 생성
   1. DELETE 기존2 신청 (id, 동반자 포함)
   2. used_count: 2 → 1
   3. INSERT 새 신청
   4. used_count: 1 → 2
   
💬 메시지: "핸드폰 번호가 수정되어 기존 신청을 업데이트합니다."
3-3. 완전 새로운 조건 신청
📋 기존1: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E
📋 기존2: 쿠폰A + 골프장X + 시간Y + 이름Z + 핸드폰W
📝 신청:  쿠폰A + 골프장K + 시간L + 이름M + 핸드폰N

❌ 처리결과: 신청 거부
💬 메시지: "이미 최대 사용 횟수(2회)에 도달한 쿠폰입니다."
3-4. 완전히 동일한 신청 (첫 번째와 동일)
📋 기존1: 쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E
📋 기존2: 쿠폰A + 골프장X + 시간Y + 이름Z + 핸드폰W
📝 신청:  쿠폰A + 골프장B + 시간C + 이름D + 핸드폰E

❌ 처리결과: 신청 거부
💬 메시지: "이미 동일한 조건으로 신청이 완료되었습니다."

🎯 핵심 로직 요약
✅ 신청 허용 조건

첫 번째 신청 (used_count = 0)
두 번째 신청 (used_count = 1) - 다른 조건
핸드폰 오입력 재신청 - 언제든지 기존 삭제 후 새로 생성

❌ 신청 거부 조건

완전히 동일한 신청 재시도
쿠폰 사용 완료 후 새로운 조건 신청

🔄 특별 처리

핸드폰 번호 수정: 기존 신청 삭제 → used_count 감소 → 새 신청 생성 → used_count 증가