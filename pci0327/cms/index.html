<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMS</title>
    <link rel="stylesheet" href="/cms/css/main.css">
    <link rel="stylesheet" href="/cms/css/sidebar.css">
    <link rel="stylesheet" href="/cms/css/content.css">
    <link rel="stylesheet" href="/cms/css/modal.css">
    <link rel="stylesheet" href="/cms/css/field-practice.css">
    <style>
        .wrapper {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 240px;
            position: fixed;
            left: 0;
            top: 0;           /* 60px에서 0으로 변경 */
            bottom: 0;
            background: #2c3e50;
            z-index: 100;
            height: 100vh;    /* calc(100vh - 60px)에서 100vh로 변경 */
        }

        .main-content {
            flex: 1;
            margin-left: 240px;  /* 사이드바 너비 */
            margin-top: 0;       /* 60px에서 0으로 변경 */
            padding: 0;
            background: #f8f9fa;
            min-height: 100vh;   /* calc(100vh - 60px)에서 100vh로 변경 */
            display: flex;
            flex-direction: column;
        }

        #header-container {
            margin: 0;
            padding: 0;
        }

        #list-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 100vh;   /* calc(100vh - 60px)에서 100vh로 변경 */
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <!-- 사이드바 -->
        <div id="sidebar-container"></div>

        <!-- 메인 컨텐츠 -->
        <div class="main-content">
            <div id="header-container"></div>
            <div id="list-content"></div>
        </div>
    </div>

    <!-- 모달 컨테이너 -->
    <div id="modal-container">
        <!-- 모달 컴포넌트가 여기에 로드됨 -->
    </div>

    <!-- 스크립트 -->
    <script src="/cms/js/datetime.js"></script>
    <script src="/cms/js/session.js"></script>
    <script src="/cms/js/common.js"></script>
    <script src="/cms/js/menu.js"></script>
    <script>
        // 컴포넌트 로드 함수
        async function loadComponent(containerId, componentPath) {
            try {
                console.log(`Loading component: ${componentPath}`);
                const response = await fetch(componentPath);
                const html = await response.text();
                
                // DOM 업데이트를 Promise로 래핑
                return new Promise(resolve => {
                    const container = document.getElementById(containerId);
                    if (!container) {
                        console.error(`Container ${containerId} not found`);
                        resolve(false);
                        return;
                    }

                    container.innerHTML = html;
                    
                    // DOM 업데이트가 완료될 때까지 대기
                    requestAnimationFrame(() => {
                        console.log(`Component ${containerId} loaded and mounted`);
                        resolve(true);
                    });
                });
            } catch (error) {
                console.error(`Error loading component ${componentPath}:`, error);
                return false;
            }
        }

        // 페이지 초기화
        async function initializeApp() {
            try {
                console.log('Initializing app...');
                
                // 사이드바 로드
                const sidebarLoaded = await loadComponent('sidebar-container', '/cms/components/sidebar.html');
                if (!sidebarLoaded) {
                    throw new Error('Failed to load sidebar');
                }

                // DOM이 완전히 업데이트될 때까지 대기
                await new Promise(resolve => setTimeout(resolve, 1000));

                // 세션 체크
                await checkSession();

                // 시계 초기화
                const dateTimeElement = document.getElementById('currentDateTime');
                console.log('DateTime element check:', {
                    found: !!dateTimeElement,
                    element: dateTimeElement
                });

                if (dateTimeElement) {
                    console.log('Starting clock...');
                    initClock();
                }

                // 나머지 컴포넌트 로드
                await loadComponent('header-container', '/cms/components/header.html');
                await loadComponent('modal-container', '/cms/components/modal.html');

                // 메뉴 초기화
                initMenuHandlers();

            } catch (error) {
                console.error('Error initializing app:', error);
            }
        }

        // DOM 로드 완료 시 앱 초기화
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html> 